<h1>Requests</h1>

<%= form_with url: requests_path, method: :get, class: "d-flex", data: { controller: 'flatpickr-search' } do |f| %>
  <%= text_field_tag :start_time, params[:start_time], data: { 'flatpickr-search-target': "startTime" } %>
  <%= text_field_tag :end_time, params[:end_time], data: { 'flatpickr-search-target': "endTime" } %>
  <%= text_field_tag :origin, params[:origin] %>
  <%= text_field_tag :destination, params[:destination] %>
  <%= submit_tag "Pesquisar" %>
<% end %>

<%= week_calendar(events: @requests, end_attribute: :end_time) do |date, requests| %>
  <%= date %>
  <% requests.each do |request| %>
    <div class="meeting">  <-- We will add some style to the meeting class later so let's add it now -->
      <p><%= request.origin %></p>
    </div>
  <% end %>
<% end %>
<div class="container">
  <div class="request_card">
    <div>
      <% @requests.each do |request| %>
        <p> Per√≠odo: <%= request.start_time %> a <%= request.end_time %> </p>
        <p> <%= request.request_type %> </p>
        <p> <%= request.origin %> <i class="fa-solid fa-arrow-right"></i> <%= request.destination %> </p>
        <p> Pedido criado em <%= request.created_at %> </p>
        <p> <%= request.available %> </p>

        <%= link_to "Avaliar", "#modalPickRequest-#{request.id}", 'data-bs-toggle'=>"modal", 'data-bs-target'=>"#modalPickRequest" %>
        <!-- Button trigger modal -->
        <%# <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalPickRequest">
          Avaliar
        </button> %>
        <!-- Button trigger modal -->
        <div class="modal fade" id="modalPickRequest-<%= request.id %>" tabindex="-1" aria-labelledby="modalPickRequest" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalPickRequest">Requisicao </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <%= render :partial => 'modal', :locals => {:request => request}%>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <label class="btn avatar-photo">
      <% if current_user.avatar.attached? %>
        <%= cl_image_tag current_user.avatar.key %>
      <% else %>
        <%= image_tag "https://randomuser.me/api/portraits/women/49.jpg"%>
      <% end %>
    </label>
    <div>
      <% @requests.each do |request| %>
      <p> <i class="fa-solid fa-user"></i> <%= request.user.first_name %><%= request.user.last_name %> </p>
      <% end %>
    </div>
  </div>
</div>
